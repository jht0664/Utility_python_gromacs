PROGRAM POlYMERIZE_PEO

  IMPLICIT NONE
  CHARACTER(LEN=5) :: RESNAME,POL_NC
  REAL :: ID0, ID1
  INTEGER :: POL_N, TOT_ATOM, I, CHGROUP, ATOM

  OPEN(Unit=10,File='conf.gro',STATUS='NEW')

  PRINT*, "This program makes a chain of Polyethyl oxide."
  PRINT*, "How many do you want to polymerize?"
  PRINT*, "Must be integer!!"

  READ(*,"(I)") POL_N
  TOT_ATOM = (POL_N-1)*7+(8*2)

  WRITE(10,"(A5,I)") "PEO_N",POL_N
  WRITE(10,"(I5)") TOT_ATOM

  ATOM = 0
  ID0 = 0.903D0
  ID1 = 1.258D0
  CHGROUP = 0

  DO
    CHGROUP = CHGROUP + 1

    IF(CHGROUP == 1) THEN
      RESNAME = "PEOB "
      WRITE(10,902) CHGROUP,RESNAME,"   C2",ATOM+1,"   0.545   1.138   1.100"
      WRITE(10,902) CHGROUP,RESNAME,"  H21",ATOM+2,"   0.539   1.201   1.011"
      WRITE(10,902) CHGROUP,RESNAME,"  H22",ATOM+3,"   0.539   1.201   1.189"
      WRITE(10,902) CHGROUP,RESNAME,"  H23",ATOM+4,"   0.457   1.073   1.100"
      WRITE(10,902) CHGROUP,RESNAME,"    O",ATOM+5,"   0.663   1.060   1.100"
      WRITE(10,902) CHGROUP,RESNAME,"   C1",ATOM+6,"   0.781   1.139   1.100"
      WRITE(10,902) CHGROUP,RESNAME,"  H11",ATOM+7,"   0.782   1.204   1.012"
      WRITE(10,902) CHGROUP,RESNAME,"  H12",ATOM+8,"   0.782   1.204   1.188"
      ATOM = ATOM + 8
      CYCLE
    ENDIF

    IF(CHGROUP == (POL_N + 1)) THEN
      RESNAME = "PEOE "
      IF(MOD(CHGROUP,2) == 0) THEN
        WRITE(10,903) CHGROUP,RESNAME,"   C2",ATOM+1,ID0,"   1.048   1.100"
        WRITE(10,903) CHGROUP,RESNAME,"  H21",ATOM+2,ID0-0.002D0,"   0.983   1.188"
        WRITE(10,903) CHGROUP,RESNAME,"  H22",ATOM+3,ID0-0.002D0,"   0.983   1.012"
        WRITE(10,903) CHGROUP,RESNAME,"    O",ATOM+4,ID0+0.119D0,"   1.126   1.100"
        WRITE(10,903) CHGROUP,RESNAME,"   C1",ATOM+5,ID0+0.237D0,"   1.047   1.100"
        WRITE(10,903) CHGROUP,RESNAME,"  H11",ATOM+6,ID0+0.239D0,"   0.983   1.188"
        WRITE(10,903) CHGROUP,RESNAME,"  H12",ATOM+7,ID0+0.239D0,"   0.983   1.012"
        WRITE(10,903) CHGROUP,RESNAME,"  H13",ATOM+8,ID1-0.027D0,"   1.112   1.100"
        WRITE(10,904) ID1+1.0D0,ID1+1.0D0,ID1+1.0D0
        ELSE
          WRITE(10,903) CHGROUP,RESNAME,"   C2",ATOM+1,ID1,"   1.126   1.100"
          WRITE(10,903) CHGROUP,RESNAME,"  H21",ATOM+2,ID1-0.006D0,"   1.189   1.011"
          WRITE(10,903) CHGROUP,RESNAME,"  H22",ATOM+3,ID1-0.006D0,"   1.189   1.189"
          WRITE(10,903) CHGROUP,RESNAME,"    O",ATOM+4,ID1+0.118D0,"   1.048   1.100"
          WRITE(10,903) CHGROUP,RESNAME,"   C1",ATOM+5,ID1+0.236D0,"   1.127   1.100"
          WRITE(10,903) CHGROUP,RESNAME,"  H11",ATOM+6,ID1+0.237D0,"   1.192   1.012"
          WRITE(10,903) CHGROUP,RESNAME,"  H12",ATOM+7,ID1+0.237D0,"   1.192   1.188"
          WRITE(10,903) CHGROUP,RESNAME,"  H13",ATOM+8,ID0-0.027D0,"   1.411   1.100"
          WRITE(10,904) ID0+1.0D0,ID0+1.0D0,ID0+1.0D0
      ENDIF
      CLOSE(10)
      PRINT*, "RPGORAM Finish!"
      STOP
    ENDIF

    IF((CHGROUP /= 1 ) .or. (CHGROUP /= (POL_N + 1))) THEN
      RESNAME = "PEO  "
      IF(MOD(CHGROUP,2) == 0) THEN
        WRITE(10,903) CHGROUP,RESNAME,"   C2",ATOM+1,ID0,"   1.048   1.100"
        WRITE(10,903) CHGROUP,RESNAME,"  H21",ATOM+2,ID0-0.002D0,"   0.983   1.188"
        WRITE(10,903) CHGROUP,RESNAME,"  H22",ATOM+3,ID0-0.002D0,"   0.983   1.012"
        WRITE(10,903) CHGROUP,RESNAME,"    O",ATOM+4,ID0+0.119D0,"   1.126   1.100"
        WRITE(10,903) CHGROUP,RESNAME,"   C1",ATOM+5,ID0+0.237D0,"   1.047   1.100"
        WRITE(10,903) CHGROUP,RESNAME,"  H11",ATOM+6,ID0+0.239D0,"   0.983   1.188"
        WRITE(10,903) CHGROUP,RESNAME,"  H12",ATOM+7,ID0+0.239D0,"   0.983   1.012"
        ID0 = ID0 + 0.709D0
        ELSE
          WRITE(10,903) CHGROUP,RESNAME,"   C2",ATOM+1,ID1,"   1.126   1.100"
          WRITE(10,903) CHGROUP,RESNAME,"  H21",ATOM+2,ID1-0.006D0,"   1.189   1.011"
          WRITE(10,903) CHGROUP,RESNAME,"  H22",ATOM+3,ID1-0.006D0,"   1.189   1.189"
          WRITE(10,903) CHGROUP,RESNAME,"    O",ATOM+4,ID1+0.118D0,"   1.048   1.100"
          WRITE(10,903) CHGROUP,RESNAME,"   C1",ATOM+5,ID1+0.236D0,"   1.127   1.100"
          WRITE(10,903) CHGROUP,RESNAME,"  H11",ATOM+6,ID1+0.237D0,"   1.192   1.012"
          WRITE(10,903) CHGROUP,RESNAME,"  H12",ATOM+7,ID1+0.237D0,"   1.192   1.188"
          ID1 = ID1 + 0.709D0
      ENDIF
      ATOM = ATOM + 7
      CYCLE
    ENDIF

    PRINT*, "ERROR!!1"
  ENDDO

! READ FORMAT
901 FORMAT(i5,2a5,i5,3f8.3,3f8.4)
! WRITE FORMAT for PEOB
902 FORMAT(i5,2a5,i5,a24)
! WRITE FORMAT for PEO
903 FORMAT(i5,2a5,i5,f8.3,a16)
904 FORMAT(3f8.3)

END PROGRAM
